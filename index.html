<html>
    <script>
        //Declaração Variaveis
        let debug=1; //Liga e desliga o debug no F12
        let dadosTabela=[];//Indice 0 é o intervalo, indice 1 é a quantidade de linhas
        let elementosDoVetor=[];
        let contagemDeElementosDoVetor=[];
        let jaCalculado = false; //Controla se já foi executado algum calculo para poder apagar as tabelas geradas

        let dadosGerais = new Object();




    </script>
    <head>
        <meta charset="utf-8">
        <title>Teste</title>
        <meta name="viewport" content="width=device-width, initial-scale = 1, shrink-to-fit=no">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
        <script src="js/jquery-3.2.1.min.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="_src/funcoes.js"></script>
        <style>

            table,tr,td, th {
                border-style: solid;
                border-width: 1px;
                border-color: black;
            }
            table {
                width: 80% !important;
                margin: auto;
            }
            .table-responsive{
              width: 100% !important;
            }



            .table-status {
                margin-top: 20px;
                margin-bottom: 20px !important;
            }
        </style>

    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <p> <!--Disparadores -->
                        <button class="btn btn-secondary" data-toggle="collapse" type="button" data-target="#ItemColapso1" aria-expanded="false" aria-controls="ItemColapso1">Teste</button>
                    </p>

                    <div class="collapse" id="ItemColapso1">
                        <div class="card card-body">
                            <div>
                                    <input type="button" name="bnt_Descritiva" id="bnt_Descritiva" onclick="dadosGerais.typeOfCalculation=0;" value="Estatística Descritiva">
                                    <input type="button" name="bnt_Probabilidade" id="bnt_Probabilidade" onclick="dadosGerais.typeOfCalculation=1;" value="Probabilidade">
                                    <input type="button" name="bnt_Correlacao" id="bnt_Correlacao" onclick="dadosGerais.typeOfCalculation=2;" value="Correlação e Regressão">
                                </div>
                                <br>
                                <div>
                                    <input type="radio" name="rad_Pesquisa" value="0" onclick="setaRadioOption(this.value)" checked>População<br>
                                    <input type="radio" name="rad_Pesquisa" value="1" onclick="setaRadioOption(this.value)">Amostra<br>
                                </div>
                                <br>
                                <div>
                                    <label for="nomeVariavel">Informe o nome da varável a ser pesquisada</label>
                                    <input type="text" value = 'Variável Pesquisada (xi)' name="nomeVariavel" id="nomeVariavel">
                                </div>
                                <br>
                                <div>
                                    <label for="nomeDescricao">Informe o label da coluna de frequencia (este parametro é opcional)</label>
                                    <input type="text" name="nomeDescricao" value = 'Frequencia (fi)' id="nomeDescricao">
                                </div>
                                <br>
                                <div>
                                    <label for="inputText">Digite os valores separados por espaço ou ;</label>
                                    <textarea  name="inputText" id="inputText" ></textarea>
                                </div>
                                <br>
                                <div>
                                    <label for="inputFile">Importar arquivo:</label>
                                    <input type="file" name="inputFile" id="inputFile"  accept=".txt, .csv" onchange="tryLoad()">
                                </div>
                                <br>
                                <div>
                                    <input type="button" name="bnt_initCalc" id="bnt_initCalc" onclick="initCalc()" value="initCalc">
                                </div>
                                <br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script>
        //Função tryLoad é responsável por importar o arquivo
        function tryLoad(){
            let reader = new FileReader();
            reader.addEventListener('load', function() {
                let res = this.result;
                document.querySelector("#inputText").value=res;
                imported=true;
            });
            reader.addEventListener('error', function() {
                dadosGerais.arr=[];
                imported=false;
            });
            let file = document.querySelector('#inputFile').files[0];
           // alert(file.name);
            if (file!=undefined){
                let ext = file.name.split('.').pop();
                if (ext =='txt' || ext=='csv') {
                    reader.readAsText(file);
                } else {
                    alert("Arquivo inválido!");

                }
            }
        };

        //Inicío dos cálculos
        function initCalc(){
            dadosGerais.arr = [];//Vetor Principal
            dadosGerais.typeOfCalculation = 0;// 0-Descritiva, 1-Probabilidade, 2-Correlação
            dadosGerais.tipoDePesquisa = 0; //0-População, 1-Amostra
            dadosGerais.varName = document.querySelector("#nomeVariavel").value; //Nome da variável a ser pesquisada
            dadosGerais.varDescription = document.querySelector("#nomeDescricao").value;//Nome da coluna de frequencia
            dadosGerais.varType='';//Tipo da variável - qualitativa, discreta ou continua
            if (jaCalculado){destroiTabela();}
            jaCalculado = true;
            dadosGerais.arr = processaInput(document.querySelector("#inputText").value);
            if (checaSeTemLetras(dadosGerais.arr)==false){dadosGerais.arr=converteEmNumeros(dadosGerais.arr);}
            dadosGerais.arr = ordenaVetor(dadosGerais.arr);
            dadosGerais.varType=verificaTipo(dadosGerais.arr); //Tipo da variável - qualitativa, discreta ou continua
            dadosGerais.maiorElemento = retornaMaior(dadosGerais.arr, dadosGerais.varType);
            dadosGerais.menorElemento = retornaMenor(dadosGerais.arr, dadosGerais.varType);
            if (dadosGerais.varType!='Qualitativa') {
                dadosGerais.amplitude = calcAmplitude(dadosGerais.maiorElemento, dadosGerais.menorElemento, dadosGerais.varType);
            }
            dadosGerais.elementos =  contaElementos(dadosGerais.arr);
            dadosGerais.copiaElementos = dadosGerais.elementos.slice();
            dadosGerais.qtdElementos = quantidadeElementos();
            dadosGerais.copiaQtdElementos = dadosGerais.qtdElementos.slice();
            dadosGerais.frequenciaPercentualReal = calcFreqPerc(dadosGerais.arr);
            dadosGerais.copiaFrequenciaPercentualReal = dadosGerais.frequenciaPercentualReal.slice();
            dadosGerais.totalFrequenciaPercentualReal = calcTotalReal(dadosGerais.frequenciaPercentualReal);
            dadosGerais.frequenciaAcumulada = calcFreqAcum(dadosGerais.qtdElementos);
            dadosGerais.copiaFrequenciaAcumulada = dadosGerais.frequenciaAcumulada.slice();
            dadosGerais.totalFrequenciaAcumuladaReal = calcTotalReal(dadosGerais.qtdElementos);
            dadosGerais.frequenciaAcumuladaPercentualReal = calcFreqAcumPerc(dadosGerais.frequenciaPercentualReal, dadosGerais.qtdElementos);
            dadosGerais.copiaFrequenciaAcumuladaPercentualReal = dadosGerais.frequenciaAcumuladaPercentualReal.slice();
            if (dadosGerais.varType=='Continua') {
                dadosGerais.K = calcK(dadosGerais.elementos);//Calcula K original (n linhas) será tualizado abaixo
                let temporario = intervaloClasse(dadosGerais.amplitude, dadosGerais.K, dadosGerais.elementos.length);
                dadosGerais.K=temporario[1];
                dadosGerais.intervaloDeClasse=temporario[0];

            }
            dadosGerais.totalFrequenciaPercentual = arredondaTotal(dadosGerais.totalFrequenciaPercentualReal);

            desenhaTabela(dadosGerais.arr, dadosGerais.varType, dadosGerais.varName, dadosGerais.varDescription, dadosGerais.copiaElementos, dadosGerais.copiaQtdElementos, dadosGerais.copiaFrequenciaPercentualReal, dadosGerais.copiaFrequenciaAcumulada, dadosGerais.copiaFrequenciaAcumuladaPercentualReal, dadosGerais.totalFrequenciaAcumuladaReal, dadosGerais.totalFrequenciaPercentual);



            if (debug){showDebug();}
        }

        //Transfere a opção escolhida (amostra ou população) para a variável de controle
        function setaRadioOption(opcao){
            dadosGerais.tipoDePesquisa=opcao;
        }
        //Exibe as informações de debug
        function showDebug(){
            for (let i in dadosGerais) {
                if (dadosGerais.hasOwnProperty(i)) {
                    console.log("dadosGerais." + i + " = " + dadosGerais[i]);
                }
            }
        }
        function sobe(pos){
            if (pos>0){
                move(pos,-1);
            }
        }
        function desce(pos, limite){
            if (pos<limite){
                move(pos,1);
            }
        }
        function move(pos, mult){
            destroiTabela();
            dadosGerais.copiaQtdElementos = trocaElementoDoArray(dadosGerais.copiaQtdElementos,pos,pos+mult);
            dadosGerais.copiaElementos = trocaElementoDoArray(dadosGerais.copiaElementos,pos,pos+mult);
            dadosGerais.copiaFrequenciaPercentualReal = trocaElementoDoArray(dadosGerais.copiaFrequenciaPercentualReal,pos,pos+mult);
            dadosGerais.copiaFrequenciaAcumulada = calcFreqAcum(dadosGerais.copiaQtdElementos);
            dadosGerais.copiaFrequenciaAcumuladaPercentualReal = calcFreqAcumPerc(dadosGerais.copiaFrequenciaPercentualReal, dadosGerais.copiaQtdElementos);
            desenhaTabela(dadosGerais.arr, dadosGerais.varType, dadosGerais.varName, dadosGerais.varDescription, dadosGerais.copiaElementos, dadosGerais.copiaQtdElementos, dadosGerais.copiaFrequenciaPercentualReal, dadosGerais.copiaFrequenciaAcumulada, dadosGerais.copiaFrequenciaAcumuladaPercentualReal, dadosGerais.totalFrequenciaAcumuladaReal, dadosGerais.totalFrequenciaPercentual);
        }
    </script>
</html>


